# SCS - Sistema de controle de senhas

API para controle de senhas que serão geradas por usuários "normais" e que serão chamadas por usuários "gerentes".

Todas as funcionalidades serão acessadas utilizando endpoints REST, variando entre métodos GET e POST.

## Banco de Dados

Para armazenamento dos dados foi utilizando sistema gerenciador de banco de dados PostgreSQL (14.2). É preciso criar um novo banco de dados (scs). Segue abaixo as tabelas que serão criadas, de forma automática (no schema public), no startup da aplicação. 

### SENHA

Conjunto de entidades representando todas as senhas que foram geradas pelos usuários, bem como as que já foram "chamadas" pelos usuários gerentes.

```
CREATE TABLE IF NOT EXISTS public.senha
(
    id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1 ),
    data_hora_senha_atendimento timestamp without time zone, -- DATA HORA EM QUE O GERENTE CHAMA A SENHA
    data_hora_senha_gerada timestamp without time zone, -- DATA HORA EM QUE O USUARIO GERA A NOVA SENHA
    senha character varying(255) COLLATE pg_catalog."default", -- SENHA QUE FOI GERADA JA CONTEMPLANDO O SUFIXO N ou P
    status character varying(255) COLLATE pg_catalog."default", -- PENDENTE (SOMENTE GERADA) / CONCLUIDO (GERADA E JA ATENDIDA)
    tipo character varying(255) COLLATE pg_catalog."default", -- NORMAL / PENDENTE
    CONSTRAINT senha_pkey PRIMARY KEY (id)
)
```

Exemplo:

| id | senha | data_hora_senha_gerada | data_hora_senha_atendimento | tipo | status |
| -- | ----- | ---------------------- | --------------------------- | ---- | ------ |
| 1 | N0001 | 2022-02-18 17:00:00 | 2022-02-18 17:00:15 | NORMAL | CONCLUIDO |
| 2 | N0002 | 2022-02-18 17:01:00 | 2022-02-18 17:01:10 | NORMAL | CONCLUIDO |
| 3 | N0003 | 2022-02-18 17:02:00 | null | NORMAL | PENDENTE |
| 4 | P0001 | 2022-02-18 17:02:10 | 2022-02-18 17:02:15 | PREFERENCIAL | CONCLUIDO |
| 5 | N0004 | 2022-02-18 17:03:00 | null | NORMAL | PENDENTE |

### SENHA_CONTROLE

Tabela de controle dos contadores das senhas normais e preferenciais. A existencia dessa tabela possibilita que os contadores sejam reinicializados, além de servir de referencia para a geração da próxima senha. Isso evita que uma nova geração de senha envolva a consulta de todas as senhas já geradas para o calculo do próximo número.

```
CREATE TABLE IF NOT EXISTS public.senha_controle
(
    id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1 ),
    senha_normal integer, -- CONTADOR DAS SENHAS NORMAIS
    senha_preferencial integer, -- CONTADOS DAS SENHAS PREFERENCIAS
    CONSTRAINT senha_controle_pkey PRIMARY KEY (id)
)
```

Exemplo:

| id | senha_preferencial | senha_normal |
| -- | ------------------ | ------------ |
| 1 | 35 | 7 |

* Nesta tabela deve existir apenas UMA linha.

## Build

O projeto utiliza POM.xml para descrição das suas propriedades, por tanto um simples "msn clean install" já faz todo o build da aplicação, com a geração do .war (/target/) e a execução de testes unitários.

## Deploy

O artefato resultado da compilação é o arquivo /target/scs-backend.war. O deploy no Tomcat pode ser feito copiando este arquivo para TOMCAT_HOME/webapps/. Se o seu Tomcat estivar com as configurações padrão, copiando o arquivo para a pasta já irá disparar o hot deploy.

## API

Foram incluídas dependências no projeto para que sejam geradas de forma automática a especificação dos endpoints, bem como a interface do Swagger UI para validação dos serviços.

### open-api-specification

- http://localhost:8080/scs-backend/v3/api-docs
- http://localhost:8080/scs-backend/v3/api-docs.yaml

### swagger-ui

- http://localhost:8080/scs-backend/swagger-ui.html
